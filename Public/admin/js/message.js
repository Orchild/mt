App.config(function($routeProvider){$routeProvider.when("/lists",{controller:"ListController",templateUrl:$CONTROLLER+"/lists.html"}).when("/add",{controller:"AddController",templateUrl:$CONTROLLER+"/add.html",publicAccess:!0}).when("/edit/:id",{controller:"EditController",templateUrl:$CONTROLLER+"/edit.html",publicAccess:!0}).otherwise({redirectTo:"/lists"})}),App.factory("Model",["$resource",function($resource){return $resource($CONTROLLER+"/:act",{act:"find"},{query:{method:"POST",params:{act:"lists"}},category:{method:"POST",params:{act:"category"}},sort:{method:"POST",params:{act:"sort"}},status:{method:"POST",params:{act:"status"}},remove:{method:"POST",params:{act:"delete"}}})}]),App.controller("MessageController",function($scope,$location,Model){$scope.$add=function(){$location.path("/add")},$scope.$lists=function(){$location.path("/")},$scope.category=[],Model.category(function(data){$scope.category=data.items})}),App.controller("ListController",function($scope,Model,$location){$scope.rows=[],$scope.page={},$scope.$reload=function(p,size){$.overlay(),Model.query(angular.extend({p:p||1,size:size||$scope.page.size},$scope.s),function(data){$scope.rows=data.items,$scope.page={count:data.count,size:data.size,page:data.page},$.unoverlay()})},$scope.$reload(),$scope.$refresh=function(){$scope.$reload($scope.page.page)},$scope.s={},$scope.$search=function(){$scope.$reload(1,0)},$scope.$sort=function(item,field){Model.sort({id:item.id,field:field,value:item[field]},function(data){data.status?item.update():alert(data.info)})},$scope.$initsort=function(item,field){confirm("您确定要重置排序吗？")&&($.overlay(),Model.sort({},function(data){$.unoverlay(),data.status?$scope.$reload(1,0):alert(data.info)}))},$scope.$status=function(item,index,value,name){var self=this;Model.status({id:item.id,field:name,value:value},function(data){data.status||alert(data.info),self.update()})},$scope.$edit=function(item){$location.path("/edit/"+item.id)},$scope.$remove=function(item){confirm("您确定要删除该条记录吗？")&&Model.remove({id:item.id},function(data){data.status||alert(data.info),item.remove(),Model.query({p:$scope.page.page,size:$scope.page.size},function(data){$scope.rows=data.items,$scope.page=data})})}}),App.controller("AddController",function($scope){$scope.action="添加",$scope.row={};var longitude=121.506191,latitude=31.245554;$scope.options={center:{longitude:longitude,latitude:latitude},zoom:17,city:"ShangHai",markers:[{longitude:longitude,latitude:latitude,icon:"img/mappiont.png",width:49,height:60,title:"Where",content:"Put description here"}]}}),App.controller("EditController",function($scope,$routeParams,Model){$scope.action="修改",$scope.row={},$scope.id=$routeParams.id,$scope.lnglat=function(data){0==data.status&&data.result&&data.result.location&&(alert(1),$scope.row.longitude=data.result.location.lng,$scope.row.latitude=data.result.location.lat)}});