routeApp.config(function($routeProvider){$routeProvider.when("/lists",{controller:"ListController",templateUrl:$CONTROLLER+"/lists.html"}).when("/add",{controller:"AddController",templateUrl:$CONTROLLER+"/add.html",publicAccess:!0}).when("/edit/:idx",{controller:"EditController",templateUrl:$CONTROLLER+"/edit.html",publicAccess:!0}).otherwise({redirectTo:"/lists"})}),routeApp.service("Menu",function($http,$resource){return $resource($CONTROLLER+"/:act",{act:"find"},{query:{method:"POST",params:{act:"lists"},isArray:!0},status:{method:"POST",params:{act:"status"}},up:{method:"POST",params:{act:"up"}},down:{method:"POST",params:{act:"down"}},remove:{method:"POST",params:{act:"delete"}},build:{method:"POST",params:{act:"build"}},clear:{method:"POST",params:{act:"clear"}}})}),routeApp.controller("main",function($scope,Menu){$scope.$build=function(){Menu.build(function(data){alert(data.info)})},$scope.$removeAll=function(){Menu.clear(function(data){alert(data.info)})}}),routeApp.controller("ListController",function($scope,$location,Menu,$filter){$scope.rows=Menu.query(),$scope.items=Menu.query({index:1}),$scope.$watchCollection("nodes",function(newCollection,oldCollection){newCollection!=oldCollection&&$scope.$refresh()}),$scope.$refresh=function(){$scope.rows=$filter("filter")($scope.nodes,{status:1}),$scope.items=$filter("filter")($scope.nodes,{status:0})},$scope.$status=function(item,idx,val,name){var self=this;Menu.status({index:idx,value:item[name]^val,name:name},function(data){self.update()})},$scope.$up=function(item,idx){Menu.up({index:idx},function(data){item.update()})},$scope.$down=function(item,idx){Menu.down({index:idx},function(data){item.update()})},$scope.$edit=function(item,idx){$location.path("/edit/"+idx)},$scope.$remove=function(item,idx){confirm("确定要删除吗？")&&Menu.remove({index:idx},function(data){item.remove()})}}),routeApp.controller("AddController",function($scope,$location,Menu){$scope.action="添加",$scope.row={controller:[""],items:[]},$scope.save=function(){Menu.create($scope.row,function(data){data.success?$location.path("/"):alert(data.msg)})}}),routeApp.controller("EditController",function($scope,$location,Menu,$routeParams){$scope.action="修改",$scope.row={controller:[""],items:[]},$scope.idx=$routeParams.idx,$scope.save=function(){Menu.update($scope.row,function(data){data.success?$location.path("/"):alert(data.msg)})}});